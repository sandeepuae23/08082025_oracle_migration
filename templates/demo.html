{% extends "base.html" %}

{% block title %}Interactive Demo - Oracle to Elasticsearch Migration{% endblock %}

{% block additional_css %}
<style>
.hero-section {
    background: linear-gradient(135deg, rgba(var(--bs-primary-rgb),0.8), rgba(33,37,41,0.9));
    color: #fff;
    padding: 4rem 2rem;
}
.hero-counters .counter {
    font-size: 2rem;
}
.tech-badges .badge {
    margin: 0 0.25rem;
}
.demo-progress {
    background: var(--bs-gray-700);
    border-radius: 0.375rem;
    overflow: hidden;
    height: 1.25rem;
}
.demo-progress .progress-bar {
    background: linear-gradient(90deg, var(--bs-primary), var(--bs-info));
}
.batch-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
    gap: 0.5rem;
}
.batch-cell {
    width: 40px;
    height: 40px;
    background: var(--bs-gray-800);
    border-radius: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.3s ease;
}
.batch-cell.completed { background: var(--bs-success); }
.batch-cell.failed { background: var(--bs-danger); }
.batch-cell.running { background: var(--bs-primary); }
.log-console {
    height: 200px;
    overflow-y: auto;
    background: var(--bs-gray-900);
    padding: 1rem;
    border-radius: 0.375rem;
}
</style>
{% endblock %}

{% block content %}
<div class="hero-section text-center">
    <h1 class="mb-3">Migration Demo</h1>
    <p class="lead mb-4">Experience Oracle to Elasticsearch migration in real-time</p>
    <div class="hero-counters d-flex justify-content-center gap-4 mb-4">
        <div class="counter text-center">
            <span id="recordsCounter">0</span>
            <small class="d-block">Records</small>
        </div>
        <div class="counter text-center">
            <span id="batchesCounter">0</span>
            <small class="d-block">Batches</small>
        </div>
        <div class="counter text-center">
            <span id="speedCounter">0</span>
            <small class="d-block">rec/s</small>
        </div>
    </div>
    <div class="tech-badges mb-4">
        <span class="badge bg-primary">Python</span>
        <span class="badge bg-warning text-dark">Flask</span>
        <span class="badge bg-danger">Oracle</span>
        <span class="badge bg-success">Elasticsearch</span>
    </div>
    <button id="startDemoBtn" class="btn btn-lg btn-light text-dark">
        <i class="fas fa-play me-2"></i>Start Demo
    </button>
</div>

<section class="mt-5">
    <h3 class="mb-3">Live Migration Simulation</h3>
    <div class="mb-3">
        <label class="form-label">Records</label>
        <div class="progress demo-progress">
            <div id="recordsProgress" class="progress-bar" style="width: 0%"></div>
        </div>
    </div>
    <div class="mb-3">
        <label class="form-label">Batches</label>
        <div class="progress demo-progress">
            <div id="batchesProgress" class="progress-bar" style="width: 0%"></div>
        </div>
    </div>
    <div class="d-flex gap-3 mb-3" id="speedEta">
        <div>Speed: <span id="speedDisplay">0</span> rec/s</div>
        <div>ETA: <span id="etaDisplay">--</span></div>
    </div>
    <div class="batch-grid mb-3" id="batchGrid"></div>
    <div class="log-console" id="logConsole"></div>
</section>

<section class="mt-5">
    <h3 class="mb-3">Features Showcase</h3>
    <ul>
        <li>Complex Oracle queries with JOINs and aggregates</li>
        <li>Batch processing with checkpoints</li>
        <li>Incremental sync with change tracking</li>
        <li>Nested and parent-child mappings in Elasticsearch</li>
    </ul>
</section>

<section class="mt-5">
    <h3 class="mb-3">Technical Architecture</h3>
    <p>Backend services built with Flask connect to Oracle and Elasticsearch. The frontend uses Bootstrap and vanilla JavaScript for interactive monitoring with real-time progress, logging, and checkpoint tracking.</p>
</section>

<!-- Toasts for notifications -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="demoToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">Demo</strong>
            <small>now</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastBody">Demo started</div>
    </div>
</div>

<!-- Batch details modal -->
<div class="modal fade" id="batchModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Batch Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="batchModalBody"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script src="{{ url_for('static', filename='js/demo.js') }}"></script>
{% endblock %}
